<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Notifications - Fleet Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../static/supabaseClient.js"></script>
  <style>
    :root { --brand-orange: #f47621; --brand-dark: #33383f; --bg-light: #f5f7fa; }
    body { font-family: "Inter", sans-serif; color: var(--brand-dark); background: var(--bg-light); display: flex; min-height: 100vh; margin:0; }
    .sidebar { width: 240px; background: #fff; border-right: 1px solid #e9edf1; display: flex; flex-direction: column; justify-content: space-between; padding: 20px 16px; }
    .menu a { padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--brand-dark); font-weight: 600; display: block; margin-bottom: 4px; transition: 0.2s; }
    .menu a.active, .menu a:hover { background: var(--brand-orange); color: #fff; }
    .logout a { display: block; padding: 12px; background: #fbe9dd; text-align: center; border-radius: 8px; text-decoration: none; color: var(--brand-dark); font-weight: 600; cursor: pointer; }
    .main { flex: 1; padding: 24px; }
    .notif-card { background: #fff; padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid var(--brand-orange); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .notif-title { font-weight: 700; margin-bottom: 4px; font-size: 16px; }
    .notif-time { font-size: 12px; color: #777; margin-top: 8px; }
    .welcome { font-weight: 600; font-size: 16px; color: var(--brand-dark); }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div>
      <div style="text-align:center; margin-bottom:20px;"><img src="flogo.png" height="40" alt="Logo"></div>
      <nav class="menu">
        <a href="dashboardf.html">Dashboard</a>
        <a href="users.html">Users</a>
        <a href="task.html">Task Assign</a>
        <a href="notifications.html" class="active">Notifications</a>
        <a href="track.html">Tracking</a>
        <a href="history.html">History Log</a>
      </nav>
    </div>
    <div class="logout"><a onclick="logout()">Logout</a></div>
  </aside>

  <main class="main">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <div>
             <div class="welcome" id="welcomeMsg">Welcome!</div>
             <h1>Notifications</h1>
        </div>
        <div id="currentDate" style="color:#666; font-size:14px;"></div>
    </div>
    <div id="notifList">
        <p>Loading notifications...</p>
    </div>
  </main>

  <script>
    const sb = window.supabaseClient;

    async function logout() {
        await sb.auth.signOut();
        window.location.href = 'loginfleet.html';
    }

    document.addEventListener('DOMContentLoaded', async () => {
        const { data: { session } } = await sb.auth.getSession();
        if (!session) return window.location.href = 'loginfleet.html';

        // Load Profile
        const { data: profile } = await sb.from('fleet_manager_records').select('first_name').eq('user_id', session.user.id).single();
        if(profile) document.getElementById('welcomeMsg').textContent = `Welcome, ${profile.first_name}!`;

        // Load Date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        // Load Notifications (Pending Requests)
        const { data, error } = await sb.from('vehicle_requests').select('*').eq('status', 'Pending').order('created_at', { ascending: false });
        const container = document.getElementById('notifList');
        container.innerHTML = '';

        if (data && data.length > 0) {
            data.forEach(r => {
                const el = document.createElement('div');
                el.className = 'notif-card';
                el.innerHTML = `
                    <div class="notif-title">New Request: ${r.ticket_id || 'Ticket'}</div>
                    <div>${r.requested_by || 'Unknown'} requested a vehicle for <strong>${r.location}</strong>.</div>
                    <div class="notif-time">${new Date(r.created_at).toLocaleString()}</div>
                `;
                container.appendChild(el);
            });
        } else {
            container.innerHTML = '<p>No new notifications.</p>';
        }
    });
  </script>
</body>
</html>